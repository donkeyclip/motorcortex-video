{"version":3,"sources":["../src/VideoClip.js"],"names":["MC","require","VideoClip","video","context","getElements","muted","canvas","ctx","getContext","addEventListener","e","canvasWidth","attrs","width","canvasHeight","height","style","transform","videoWidth","videoHeight","setCustomEntity","startFrom","sources","map","item","i","join","API","DOMClip","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAC,2BAAD,CAAlB;;IAEMC,S;;;;;;;;;;;;;oCAsBc;AAAA;;AACZ,UAAMC,KAAK,GAAG,KAAKC,OAAL,CAAaC,WAAb,CAAyB,OAAzB,EAAkC,CAAlC,CAAd;AACAF,MAAAA,KAAK,CAACG,KAAN,GAAc,IAAd;AACA,UAAMC,MAAM,GAAG,KAAKH,OAAL,CAAaC,WAAb,CAAyB,QAAzB,EAAmC,CAAnC,CAAf;AACA,UAAMG,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAZ;AAEAN,MAAAA,KAAK,CAACO,gBAAN,CAAuB,gBAAvB,EAAyC,UAACC,CAAD,EAAO;AAC5C,YAAMC,WAAW,GAAG,KAAI,CAACC,KAAL,CAAWC,KAAX,IAAoB,GAAxC;AACA,YAAMC,YAAY,GAAG,KAAI,CAACF,KAAL,CAAWG,MAAX,IAAqB,GAA1C,CAF4C,CAG5C;;AACAT,QAAAA,MAAM,CAACU,KAAP,CAAaC,SAAb,mBAAkCN,WAAW,GAAGT,KAAK,CAACgB,UAAtD,eAAqEJ,YAAY,GAAGZ,KAAK,CAACiB,WAA1F;AACAb,QAAAA,MAAM,CAACU,KAAP,CAAa,kBAAb,IAAmC,UAAnC;AACAV,QAAAA,MAAM,CAACO,KAAP,GAAeX,KAAK,CAACgB,UAArB;AACAZ,QAAAA,MAAM,CAACS,MAAP,GAAgBb,KAAK,CAACiB,WAAtB;AACH,OARD,EAQG,KARH;AAUA,WAAKC,eAAL,CAAqB,OAArB,EAA8B;AAC1BlB,QAAAA,KAAK,EAALA,KAD0B;AAE1BI,QAAAA,MAAM,EAANA,MAF0B;AAG1BC,QAAAA,GAAG,EAAHA,GAH0B;AAI1Bc,QAAAA,SAAS,EAAE,KAAKT,KAAL,CAAWS,SAAX,GAAuB,IAAvB,IAA+B;AAJhB,OAA9B;AAMH;;;wBA3CU;AAAA;;AACP,sFAEqC,KAAKT,KAAL,CAAWC,KAAX,IAAoB,GAFzD,uBAEyE,KAAKD,KAAL,CAAWG,MAAX,IAAqB,GAF9F,sDAGU,KAAKH,KAAL,CAAWU,OAAX,CAAmBC,GAAnB,CAAuB,UAACC,IAAD,EAAOC,CAAP;AAAA,6DACND,IADM,gBACI,MAAI,CAACZ,KAAL,CAAWS,SAAX,IAAwB,CAD5B;AAAA,OAAvB,EAECK,IAFD,CAEM,EAFN,CAHV;AAUH;;;wBAES;AACN;AAKH;;;;EApBmB3B,EAAE,CAAC4B,GAAH,CAAOC,O;;AA+C/BC,MAAM,CAACC,OAAP,GAAiB7B,SAAjB","sourcesContent":["const MC = require('@kissmybutton/motorcortex');\n\nclass VideoClip extends MC.API.DOMClip {\n    get html() {\n        return `\n        <div>\n            <video id=\"video\" style=\"width:${this.attrs.width || 640}px;height:${this.attrs.height || 360}px;\" preload=\"auto\">\n                ${this.attrs.sources.map((item, i) => `\n                    <source src=\"${item}#t=${this.attrs.startFrom || 0}\"></source>\n                `).join('')}\n            </video>\n            <canvas id=\"canvas\"></canvas>\n        </div>\n        `\n    }\n\n    get css() {\n        return `\n            #video{\n                display:none;\n            }\n        `\n    }\n\n    onAfterRender() {\n        const video = this.context.getElements(\"video\")[0];\n        video.muted = true;\n        const canvas = this.context.getElements(\"canvas\")[0];\n        const ctx = canvas.getContext('2d');\n\n        video.addEventListener(\"loadedmetadata\", (e) => {\n            const canvasWidth = this.attrs.width || 640;\n            const canvasHeight = this.attrs.height || 360;\n            // console.log(canvasWidth / video.videoWidth, canvasHeight / video.videoHeight)\n            canvas.style.transform = `scale(${canvasWidth / video.videoWidth}, ${canvasHeight / video.videoHeight})`;\n            canvas.style['transform-origin'] = \"top left\";\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n        }, false);\n\n        this.setCustomEntity(\"video\", {\n            video,\n            canvas,\n            ctx,\n            startFrom: this.attrs.startFrom * 1000 || 0\n        });\n    }\n}\n\nmodule.exports = VideoClip;\n"],"file":"VideoClip.js"}