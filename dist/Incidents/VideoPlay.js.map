{"version":3,"sources":["../../src/Incidents/VideoPlay.js"],"names":["MC","require","VideoPlay","millisecond","video","element","entity","ctx","playPromise","play","hasSetWaitingListener","addEventListener","_waitingHandler","bind","hasSetCanplayListener","_canplayHandler","drawFrame","drawImage","timeout","setTimeout","console","log","setBlock","unblock","pause","clearTimeout","f","startFrom","currentTime","API","MediaPlayback","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAC,2BAAD,CAAlB;;IAEMC,S;;;;;;;;;;;;;yBACGC,W,EAAa;AAAA;;AACd,UAAMC,KAAK,GAAG,KAAKC,OAAL,CAAaC,MAAb,CAAoBF,KAAlC;AACA,UAAMG,GAAG,GAAG,KAAKF,OAAL,CAAaC,MAAb,CAAoBC,GAAhC;AAEA,UAAMC,WAAW,GAAGJ,KAAK,CAACK,IAAN,EAApB;;AACA,UAAI,KAAKC,qBAAL,KAA+B,IAAnC,EAAyC;AACrCN,QAAAA,KAAK,CAACO,gBAAN,CAAuB,SAAvB,EAAkC,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAAlC;AACA,aAAKH,qBAAL,GAA6B,IAA7B;AACH;;AACD,UAAI,KAAKI,qBAAL,KAA+B,IAAnC,EAAyC;AACrCV,QAAAA,KAAK,CAACO,gBAAN,CAAuB,SAAvB,EAAkC,KAAKI,eAAL,CAAqBF,IAArB,CAA0B,IAA1B,CAAlC;AACA,aAAKC,qBAAL,GAA6B,IAA7B;AACH;;AAED,UAAME,SAAS,GAAG,SAAZA,SAAY,CAACZ,KAAD,EAAW;AACzBG,QAAAA,GAAG,CAACU,SAAJ,CAAcb,KAAd,EAAqB,CAArB,EAAwB,CAAxB;AAEA,QAAA,KAAI,CAACc,OAAL,GAAeC,UAAU,CAAC,YAAW;AACjCH,UAAAA,SAAS,CAACZ,KAAD,CAAT;AACH,SAFwB,EAEtB,EAFsB,CAAzB;AAGH,OAND;;AAOAY,MAAAA,SAAS,CAACZ,KAAD,CAAT;AAEA,aAAO,IAAP;AACH;;;sCAEiB;AACdgB,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACA,WAAKC,QAAL,CAAc,eAAd;AACH;;;sCAEiB;AACdF,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,WAAKE,OAAL;AACH;;;2BAEM;AACH,WAAKlB,OAAL,CAAaC,MAAb,CAAoBF,KAApB,CAA0BoB,KAA1B;AACAC,MAAAA,YAAY,CAAC,KAAKP,OAAN,CAAZ;AACH;;;+BAEUQ,C,EAAGvB,W,EAAa;AACvB,UAAMwB,SAAS,GAAGxB,WAAW,GAAG,KAAKE,OAAL,CAAaC,MAAb,CAAoBqB,SAApD;AACA,WAAKtB,OAAL,CAAaC,MAAb,CAAoBF,KAApB,CAA0BwB,WAA1B,GAAwC,CAACD,SAAS,GAAGxB,WAAb,IAA4B,IAApE;AACA,WAAKE,OAAL,CAAaC,MAAb,CAAoBC,GAApB,CAAwBU,SAAxB,CAAkC,KAAKZ,OAAL,CAAaC,MAAb,CAAoBF,KAAtD,EAA6D,CAA7D,EAAgE,CAAhE;AACH;;;;EA/CmBJ,EAAE,CAAC6B,GAAH,CAAOC,a;;AAkD/BC,MAAM,CAACC,OAAP,GAAiB9B,SAAjB","sourcesContent":["const MC = require(\"@kissmybutton/motorcortex\");\n\nclass VideoPlay extends MC.API.MediaPlayback {\n    play(millisecond) {\n        const video = this.element.entity.video;\n        const ctx = this.element.entity.ctx;\n\n        const playPromise = video.play();\n        if (this.hasSetWaitingListener !== true) {\n            video.addEventListener('waiting', this._waitingHandler.bind(this));\n            this.hasSetWaitingListener = true;\n        }\n        if (this.hasSetCanplayListener !== true) {\n            video.addEventListener('canplay', this._canplayHandler.bind(this));\n            this.hasSetCanplayListener = true;\n        }\n\n        const drawFrame = (video) => {\n            ctx.drawImage(video, 0, 0);\n\n            this.timeout = setTimeout(function() {\n                drawFrame(video);\n            }, 10);\n        }\n        drawFrame(video);\n\n        return true;\n    }\n\n    _waitingHandler() {\n        console.log('waiting');\n        console.log('and blocking');\n        this.setBlock('Video loading');\n    }\n\n    _canplayHandler() {\n        console.log('unblocking');\n        this.unblock();\n    }\n\n    stop() {\n        this.element.entity.video.pause();\n        clearTimeout(this.timeout);\n    }\n\n    onProgress(f, millisecond) {\n        const startFrom = millisecond + this.element.entity.startFrom;\n        this.element.entity.video.currentTime = (startFrom + millisecond) / 1000;\n        this.element.entity.ctx.drawImage(this.element.entity.video, 0, 0);\n    }\n}\n\nmodule.exports = VideoPlay;\n"],"file":"VideoPlay.js"}