!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@donkeyclip/motorcortex")):"function"==typeof define&&define.amd?define(["@donkeyclip/motorcortex"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["@kissmybutton/motorcortex-video"]=e(t.MotorCortex)}(this,(function(t){"use strict";class e extends t.BrowserClip{get html(){this.width=this.attrs.width||640,this.height=this.attrs.height||360,this.startFrom=this.attrs.startFrom||0;const t="width:".concat(this.width,"px;height:").concat(this.height,"px;"),e=this.attrs.sources.map((t=>'<source src="'.concat(t,"#t=").concat(this.startFrom,'"></source>'))).join("\n");return'\n      <div>\n        <video id="video" style="'.concat(t,'" preload="metadata" ').concat(!0!==this.attrs.audio?"muted":""," playsinline>\n          ").concat(e,"\n        </video>\n      </div>\n    ")}get css(){return""}setVolume(t){this.video.volume=t}onAfterRender(){const t=this.context.getElements("video")[0];if(this.video=t,this.setCustomEntity("video",{video:t,startFrom:this.startFrom}),!0!==this.attrs.audio)t.muted=!0;else{const e=this;setTimeout((()=>{t.crossOrigin="anonymous";const i=e.DescriptiveIncident.volumeChangeSubscribe(e.id,e.setVolume.bind(e));e.setVolume(i)}),0)}}}class i extends t.MediaPlayback{play(){const t=this.element.entity.video;return t.readyState<3&&this.waitingHandler(),this.playPromise=t.play(),!0!==this.hasSetWaitingListener&&(t.addEventListener("waiting",this.waitingHandler.bind(this)),this.hasSetWaitingListener=!0),!0!==this.hasSetCanplayListener&&(t.addEventListener("canplay",this.canplayHandler.bind(this)),t.addEventListener("canplaythrough",this.canplayHandler.bind(this)),t.addEventListener("playing",this.canplayHandler.bind(this)),t.addEventListener("ready",this.canplayHandler.bind(this)),this.hasSetCanplayListener=!0),!0}waitingHandler(){this.setBlock("Video loading")}canplayHandler(){setTimeout((()=>this.unblock()))}stop(){this.playPromise&&this.playPromise.then((()=>{this.element.entity.video.pause()}))}onProgress(t){this.unblock();const e=t+this.element.entity.startFrom;this.element.entity.video.currentTime=(e+t)/1e3}}return{npm_name:"@kissmybutton/motorcortex-video",version:"2.2.1",incidents:[{exportable:i,name:"Playback"}],Clip:{exportable:e,attributesValidationRules:{sources:{optional:!1,type:"array",min:1,items:{type:"string"}},width:{optional:!0,type:"number",integer:!0,positive:!0},height:{optional:!0,type:"number",integer:!0,positive:!0},startFrom:{optional:!0,type:"number",integer:!0,min:0},audio:{optional:!0,type:"boolean",default:!0}}},capabilities:{speed:!1,preview:!1},audio:"on"}}));
